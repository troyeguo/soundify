{"ast":null,"code":"const axios = require(\"axios\");\n\nconst GITHUB_BASE_URL = \"https://api.github.com\";\nconst isServer = true; // 服务端环境需要手动拼接url\n\nasync function requestGithub(method, url, data, headers) {\n  if (!url) {\n    throw new Error(\"url must be provided\");\n  }\n\n  const result = await axios({\n    method,\n    url: `${GITHUB_BASE_URL}${url}`,\n    data,\n    headers\n  });\n  return result;\n}\n\nasync function request({\n  method = \"GET\",\n  url,\n  data = {}\n}, req, res) {\n  if (isServer) {\n    const {\n      session\n    } = req;\n    const {\n      githubAuth\n    } = session || {};\n    const {\n      access_token,\n      token_type\n    } = githubAuth || {};\n    const headers = {};\n\n    if (access_token) {\n      headers.Authorization = `${token_type} ${access_token}`;\n    } // 服务端走requestGithub方法，\n    // 补全api的前缀\n\n\n    const serverResult = await requestGithub(method, url, data, headers);\n    return serverResult;\n  } // 客户端需要拼接github前缀 让koa的server可以识别并代理\n\n\n  const clientResult = await axios({\n    method,\n    url: `/github${url}`,\n    data\n  });\n  return clientResult;\n}\n\nmodule.exports = {\n  request,\n  requestGithub\n};","map":null,"metadata":{},"sourceType":"script"}